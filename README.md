## 3.0 Заключительная часть дипломной работы. Выполненные задачи.

Ключевая задача была разработать отказоустойчивую инфраструктуру для сайта, включающую мониторинг, сбор логов и резервное копирование основных данных. Инфраструктура размещена в Yandex Cloud и отвечает минимальным стандартам безопасности.

Все этапы выполнения и скриншоты представлены во [второй части дипломной работы.](https://github.com/tverdyakov/diplom_tverdyakov-sys-20/blob/main/02_Основная%20часть%20дипломной%20работы/README.md) 

### Инфраструктура
Для развёртки инфраструктуры использовались Terraform и Ansible.  

Для Ansible не использовались inventory ip-адреса! Подключение Ansible к серверам было осуществлено через bastion host с помощью ProxyCommand.

Использовались минимальные конфигурации ВМ: 2 ядра 20% Intel ice lake, 2-4Гб памяти, 10hdd. 

### Сайт
Созданы две ВМ (веб-сервера) в разных зонах с установленым сервером nginx.

Использовался статичный файл для сайта.

Создана Target Group с 2мя веб-серверами.

Создана Backend Group. Настроена backends на target group с 2мя веб-серверами. Настроен healthcheck на корень (/) и порт 80, протокол HTTP.

Создан HTTP router. Путь указан — /, backend group — созданную ранее.

Создан Application load balancer для распределения трафика на веб-сервера, созданные ранее. Указан HTTP router, созданный ранее, задан listener тип auto, порт 80.

Сайт и балансировщик протестированы.

### Мониторинг
Создана ВМ с Zabbix. На каждую ВМ установлен Zabbix Agent. Агенты настроены на отправление метрик в Zabbix. 

Настроены дешборды с отображением метрик. Минимальный набор — по принципу USE (Utilization, Saturation, Errors) для CPU, RAM, диски, сеть, http запросов к веб-серверам. 

### Логи
Cоздана ВМ с Elasticsearch. Установлен Filebeat в ВМ к веб-серверам. Filebeat настроен на отправку access.log, error.log nginx в Elasticsearch.

Создана ВМ с Kibana. Сконфигурировано соединение с Elasticsearch.

### Сеть
Развернут один VPC. Сервера web, Elasticsearch помещены в приватные подсети. Сервера Zabbix, Kibana, application load balancer определены в публичную подсеть.

Настроены Security Groups соответствующих сервисов на входящий трафик только к нужным портам.

Настроена ВМ с публичным адресом, в которой открыт только один порт — ssh.  Эта ВМ  реализовывает концепцию bastion host. Подключение ansible к серверам web и Elasticsearch через данный bastion host сделано с помощью ProxyCommand.

### Резервное копирование
Созданы snapshot дисков всех ВМ. Время жизни snaphot - неделя. Snaphot настроен на ежедневное копирование.

---
